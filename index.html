<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="PanGongsen&#39;s Blog">
<meta property="og:url" content="https://pangongsen.github.io/index.html">
<meta property="og:site_name" content="PanGongsen&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PanGongsen&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://pangongsen.github.io/"/>





  <title>PanGongsen's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PanGongsen's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">我只是讨厌屈服。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2018/04/25/Flink水位线不触发的几点总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/25/Flink水位线不触发的几点总结/" itemprop="url">Flink水位线不触发的几点总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-25T23:48:54+08:00">
                2018-04-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flink/" itemprop="url" rel="index">
                    <span itemprop="name">Flink</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>窗口计算时遇到好几次水位线不触发的情况，简单总结下。</p>
<p>首先，介绍下Flink的事件时间(EventTime)和水位线(Watermarks)的概念。</p>
<h2 id="一、处理时间"><a href="#一、处理时间" class="headerlink" title="一、处理时间"></a>一、处理时间</h2><p>如果要构造一个实时的流式应用，或早或晚都会接触到EventTime这个概念。现实场景中也会遇到消息乱序到达，这里会介绍到为什么需要事件时间和如何去处理乱序到达的数据。<br>ProcessingTime是Flink系统处理这条消息的时间，EventTime可以理解成是这条消息真实发生的时间。<br>举个例子，创建一个SlidingWindow，窗口大小为10秒，步长为5秒。关于窗口的更多概念，可以参考<a href="http://flink.iteblog.com/dev/windows.html" target="_blank" rel="noopener">Flink官方文档——Windows</a>。</p>
<h3 id="案例1：消息都按时到达"><a href="#案例1：消息都按时到达" class="headerlink" title="案例1：消息都按时到达"></a>案例1：消息都按时到达</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> text = senv.socketTextStream(<span class="string">"localhost"</span>, <span class="number">9999</span>)</span><br><span class="line"><span class="keyword">val</span> counts = text.map &#123;(m: <span class="type">String</span>) =&gt; (m.split(<span class="string">","</span>)(<span class="number">0</span>), <span class="number">1</span>) &#125;</span><br><span class="line">    .keyBy(<span class="number">0</span>)</span><br><span class="line">    .timeWindow(<span class="type">Time</span>.seconds(<span class="number">10</span>), <span class="type">Time</span>.seconds(<span class="number">5</span>))</span><br><span class="line">    .sum(<span class="number">1</span>)</span><br><span class="line">counts.print</span><br><span class="line">senv.execute(<span class="string">"ProcessingTime processing example"</span>)</span><br></pre></td></tr></table></figure>
<p>如果source中有三条消息，对应的事件时间分别为13秒、13秒和16秒：<br><img src="/uploads/watermarks/pr_ino_source.png" alt="pr_ino_source"><br>它们会落到正确的窗口上，如下图所示。13秒产生的两条消息会落到窗口1[5s-15s]和窗口2[10s-20s]上，16秒产生的消息会落到窗口2[10s-20s]和窗口3[15s-25s]上。最后窗口fire掉时，三个窗口的count值分别为：(a,2), (a,3) and (a,1) ，和预期一致。<br><img src="/uploads/watermarks/pr_ino_windows.png" alt="pr_ino_windows"></p>
<h3 id="案例2：消息delay"><a href="#案例2：消息delay" class="headerlink" title="案例2：消息delay"></a>案例2：消息delay</h3><p>其中一条13秒产生的消息晚到了6s，那按上面的代码逻辑，这些消息会落到下面的窗口中：<br><img src="/uploads/watermarks/pr_ooo_windows.png" alt="pr_ooo_windows"><br>延迟的消息会落到窗口2[10s-20s]和窗口3[15s-25s]上。这看起来对窗口2没有影响，因为结果都是3，但窗口3的结果却不一致了。</p>
<h2 id="二、事件时间"><a href="#二、事件时间" class="headerlink" title="二、事件时间"></a>二、事件时间</h2><p>因此此处我们采用事件时间，这里水位线的事件时间为当前系统的时间，当然你可以改成数据中的某个时间。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimestampExtractor</span> <span class="keyword">extends</span> <span class="title">AssignerWithPeriodicWatermarks</span>[<span class="type">String</span>] <span class="keyword">with</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">extractTimestamp</span></span>(e: <span class="type">String</span>, prevElementTimestamp: <span class="type">Long</span>) = &#123;</span><br><span class="line">    e.split(<span class="string">","</span>)(<span class="number">1</span>).toLong </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getCurrentWatermark</span></span>(): <span class="type">Watermark</span> = &#123; </span><br><span class="line">      <span class="keyword">new</span> <span class="type">Watermark</span>(<span class="type">System</span>.currentTimeMillis)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">senv.setStreamTimeCharacteristic(<span class="type">TimeCharacteristic</span>.<span class="type">EventTime</span>)</span><br><span class="line"><span class="keyword">val</span> text = senv.socketTextStream(<span class="string">"localhost"</span>, <span class="number">9999</span>)</span><br><span class="line">                .assignTimestampsAndWatermarks(<span class="keyword">new</span> <span class="type">TimestampExtractor</span>) </span><br><span class="line"><span class="keyword">val</span> counts = text.map &#123;(m: <span class="type">String</span>) =&gt; (m.split(<span class="string">","</span>)(<span class="number">0</span>), <span class="number">1</span>) &#125;</span><br><span class="line">      .keyBy(<span class="number">0</span>)</span><br><span class="line">      .timeWindow(<span class="type">Time</span>.seconds(<span class="number">10</span>), <span class="type">Time</span>.seconds(<span class="number">5</span>))</span><br><span class="line">      .sum(<span class="number">1</span>)</span><br><span class="line">counts.print</span><br><span class="line">senv.execute(<span class="string">"EventTime processing example"</span>)</span><br></pre></td></tr></table></figure>
<p>结果如下图所示：<br><img src="/uploads/watermarks/ev_ooo_windows.png" alt="ev_ooo_windows"><br>结果看起来好很多，窗口2和3都正确了，但窗口1却丢了一条数据。<br>Flink没有将delay的数据分配给窗口3是因为现在是检查消息的事件时间，因此不会放入窗口三中。而没有分配给窗口1的原因是delayed的消息到达系统的时间是19秒，窗口1已经fire掉了。此处就需要watermarks了。</p>
<h2 id="三、水位线（水印）"><a href="#三、水位线（水印）" class="headerlink" title="三、水位线（水印）"></a>三、水位线（水印）</h2><p>我认为水位线是很重要和有趣的一个概念，我这里会大概描述下，如果想了解更多可以看<a href="https://www.youtube.com/watch?v=3UfZN59Nsk8" target="_blank" rel="noopener">Google一场精彩的talk</a>，也可以看这个<a href="https://data-artisans.com/blog/how-apache-flink-enables-new-streaming-applications-part-1" target="_blank" rel="noopener">dataArtisans的blog</a>。水位线简单理解就是一个timestamp，当Flink收到这个水印时，Flink理解会收到来自这个时间点之后的消息，也可以理解成告诉Flink运行到哪个事件时间了。<br>在这个案例中，其实就是告诉Flink一条消息可以迟到多久。<br>我现在设置水位线为现在的事件提前5秒，相当于告诉Flink我的消息可以迟到五秒。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getCurrentWatermark</span></span>(): <span class="type">Watermark</span> = &#123; </span><br><span class="line">      <span class="keyword">new</span> <span class="type">Watermark</span>(<span class="type">System</span>.currentTimeMillis - <span class="number">5000</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>结果变成下图所示:<br><img src="/uploads/watermarks/ev_ooo_windows_wat.png" alt="ev_ooo_windows_wat"></p>
<h2 id="四、允许延迟-Lateness"><a href="#四、允许延迟-Lateness" class="headerlink" title="四、允许延迟(Lateness)"></a>四、允许延迟(Lateness)</h2><p>如果采用“watermark - delay”，如果水位线不超过window_length + delay是不会被fire掉的，所以此刻可以采用allowedLateness方法。在window_end_time + allowed lateness之前，Flink都不会丢弃这条数据。<br>当消息到达时，Flink会提取它的时间，然后判断它是否在有效的延迟时间内，然后去判断是否fire掉窗口。<br>但是通过这种途径，一个窗口有可能被fire掉多次，如果需要exactly once processing的话，需要保证sink是幂等的。</p>
<h2 id="五、水位线怎么不触发？"><a href="#五、水位线怎么不触发？" class="headerlink" title="五、水位线怎么不触发？"></a>五、水位线怎么不触发？</h2><p>数据一直有序得进来，为什么没有窗口被fire掉？没有结果产出？</p>
<h3 id="case1：提取时间失败"><a href="#case1：提取时间失败" class="headerlink" title="case1：提取时间失败"></a>case1：提取时间失败</h3><p>笔者和上游约定好了数据格式，extractTimestamp中提取的是某个字段为事件时间。研究数据发现约定好的字段突然不发了。</p>
<h3 id="case2：提取时间有了，但是照样失败"><a href="#case2：提取时间有了，但是照样失败" class="headerlink" title="case2：提取时间有了，但是照样失败"></a>case2：提取时间有了，但是照样失败</h3><p>上游按约定发了该字段后，系统在测试环境运行了一段时间，又没有结果产出了。<br>调试发现提取时间正常，checkAndGetNextWatermark也正常，但是为什么窗口没被fire掉呢。<br>因为时间的format变了，由到毫秒的timestamp变成了yyyymmddHHmmss，需要转成timestamp。</p>
<h3 id="case3：一切正常，窗口不fire"><a href="#case3：一切正常，窗口不fire" class="headerlink" title="case3：一切正常，窗口不fire"></a>case3：一切正常，窗口不fire</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">EventTimeTrigger.java</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TriggerResult <span class="title">onElement</span><span class="params">(Object element, <span class="keyword">long</span> timestamp, TimeWindow window, TriggerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (window.maxTimestamp() &lt;= ctx.getCurrentWatermark()) &#123;</span><br><span class="line">		<span class="comment">// if the watermark is already past the window fire immediately</span></span><br><span class="line">		<span class="keyword">return</span> TriggerResult.FIRE;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ctx.registerEventTimeTimer(window.maxTimestamp());</span><br><span class="line">		<span class="keyword">return</span> TriggerResult.CONTINUE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看了下EventTimeTrigger的源码，只有当当前的水位线越过窗口，即时间大于窗口的endTime才会触发Fire的操作。我们的处理流程没有触发，那就说明我们的水位线没有更新到合适的值。调试后发现当前的水位线一直停留在初始的最小的long值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BoundedOutOfOrdernessTimestampExtractor.java</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Watermark <span class="title">getCurrentWatermark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// this guarantees that the watermark never goes backwards.</span></span><br><span class="line">	<span class="keyword">long</span> potentialWM = currentMaxTimestamp - maxOutOfOrderness;</span><br><span class="line">	<span class="keyword">if</span> (potentialWM &gt;= lastEmittedWatermark) &#123;</span><br><span class="line">		lastEmittedWatermark = potentialWM;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Watermark(lastEmittedWatermark);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>debug发现lastEmittedWatermark确实有更新，这说明这个地方是触发了Watermark的值。但是debug的过程中，发现时不时会出现初始值的水位线。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SystemProcessingTimeService.java</span><br><span class="line">TimestampsAndPeriodicWatermarksOperator.java</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProcessingTime</span><span class="params">(<span class="keyword">long</span> timestamp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">// register next timer</span></span><br><span class="line">	Watermark newWatermark = userFunction.getCurrentWatermark();</span><br><span class="line">	<span class="keyword">if</span> (newWatermark != <span class="keyword">null</span> &amp;&amp; newWatermark.getTimestamp() &gt; currentWatermark) &#123;</span><br><span class="line">		currentWatermark = newWatermark.getTimestamp();</span><br><span class="line">		<span class="comment">// emit watermark</span></span><br><span class="line">		output.emitWatermark(newWatermark);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">long</span> now = getProcessingTimeService().getCurrentProcessingTime();</span><br><span class="line">	getProcessingTimeService().registerTimer(now + watermarkInterval, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>TimestampsAndPeriodicWatermarksOperator会做判断：如果新的水位线小于当前的水位线，就不会更新了。<br>终于，顺着StreamInputProcessor–&gt;StatusWatermarkValve理了下来，看见这样的处理逻辑:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">StreamInputProcessor.java</span><br><span class="line">StatusWatermarkValve.java</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findAndOutputNewMinWatermarkAcrossAlignedChannels</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">long</span> newMinWatermark = Long.MAX_VALUE;</span><br><span class="line">	<span class="comment">// determine new overall watermark by considering only watermark-aligned channels across all channels</span></span><br><span class="line">	<span class="keyword">for</span> (InputChannelStatus channelStatus : channelStatuses) &#123;</span><br><span class="line">		<span class="keyword">if</span> (channelStatus.isWatermarkAligned) &#123;</span><br><span class="line">			newMinWatermark = Math.min(channelStatus.watermark, newMinWatermark);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// we acknowledge and output the new overall watermark if it is larger than the last output watermark</span></span><br><span class="line">	<span class="keyword">if</span> (newMinWatermark &gt; lastOutputWatermark) &#123;</span><br><span class="line">		lastOutputWatermark = newMinWatermark;</span><br><span class="line">		outputHandler.handleWatermark(<span class="keyword">new</span> Watermark(lastOutputWatermark));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>这里会将所有的channel status的水位线做个汇总：取最小的水位线。那是不是问题出在这里？后面debug了下看看，确实，这个地方有的channel status下的水位线一直是最小的long值那个不正常的水位线，进而导致整体的水位线发送不出去。<br>那么为什么会出现这种情况呢，百思不得其解。<br>当 [window_start_time,window_end_time) 有数据，watermark Time大于等于window_end_time时，会触发window trigger。<br>因为之前运行都是正常的，检查了数据也没问题。去翻改动，有影响的可能就是改了一些算子的并行度。<br>assigntimestampandwatermarks和map的并行度一样了就不能生成水位线了？<br>于是修改了assigntimestampandwatermarks的并行度，window正常fire掉了。amazing。<br>不知道是不是Flink的bug，已经提交。后续更新。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2018/02/25/那就留下一个故事吧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/25/那就留下一个故事吧/" itemprop="url">那就留下一个故事吧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-25T00:10:50+08:00">
                2018-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>刚好赶上徒游兼职领队招聘的日子，官方说需要一份简历，顺便在此可以总结下自己旅行的日子，谈谈对于旅行的看法。</p>
<h2 id="一、"><a href="#一、" class="headerlink" title="一、"></a>一、</h2><p>北京时间杭州时间龙须山时间2016年4月2日-3日，第一次参加徒游的活动还历历在目，当时我还是个200多斤的大胖子。遇见左边，遇见面瘫，遇见一群有情有义可爱的人儿。<br><img src="/uploads/travel/longxu.jpg" alt="longxu"><br>“大家好，我叫小胖。我现在在运动，已经瘦了10多斤了。”<br>结果我瘦了十几斤的样子如下图。。。<br><img src="/uploads/travel/longxu2.jpg" alt="longxu2"><br>自此喜欢上徒步，将旅行和运动两项自己很喜欢的事情有机地结合起来。<br>因为世事总是难料。<br>所以不敢也不想太过分得执着于将来，把眼前和当下过得饱满就好。<br>也许吧，一切都是虚渺，都是捕风捉影。如果人生一定要有什么意义的话，只有自己才可以定义它的轨迹。那些走过的路，翻过的山川和云海，踏过的沙漠和荒野，游过的岛屿和大海，和路上遇到的人和故事，足够幸运的话还能结交上三五好友，大概就是一步一个脚印走出了人生吧。<br>六月和好友去东极岛玩还偶遇二一hhh。<br><img src="/uploads/travel/dongji.jpg" alt="dongji"></p>
<h2 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h2><p>再见徒游已经是2017年的事情了，自此一发不可收拾，就好像身边的驴友说的“很久不走脚会变痒”。<br><img src="/uploads/travel/qingliangfeng.jpg" alt="qingliangfeng"><br><img src="/uploads/travel/dongbai.jpg" alt="dongbai"><br><img src="/uploads/travel/tgl.jpg" alt="tgl"><br><img src="/uploads/travel_2/tgl2.jpg" alt="tgl2"><br><img src="/uploads/travel/btgy.jpg" alt="btgy"><br><img src="/uploads/travel/westlake.jpg" alt="westlake"><br><img src="/uploads/travel/50km.jpg" alt="50km"><br><img src="/uploads/travel/qianba.jpg" alt="qianba"><br>以上都是和徒游走过的路，即使没有光影和文字记录下来，这些经历对我而言都弥足珍贵。<br>“这里时间是完整的，你看着它们从黎明和黄昏庄严展开；每天都像一朵花，像一朵玫瑰，含苞，盛开，没有懊悔而是以接受自然进程的方式凋谢。”<br>花开花谢般从容的日子，大概只有在忘我的旅行中才能找到。只是当时都太快活了，欲辨已忘言。<br>刚开始徒步的时候也许会像那些骑行西藏的哥们一样，“我特码脑抽了，不好好在家带着，在这里受罪”。走着走着，就会感觉每一次完成旅程就好像心灵得到了升华。就像在塔尔寺看到那些信徒一样，每跪拜一下就像风吹一次经幡，祈福一切顺利，心无杂念。</p>
<h2 id="三、"><a href="#三、" class="headerlink" title="三、"></a>三、</h2><p>那些不在徒游的日子里，或结伴或兀自独行也走了一些地方。一直觉得旅行中风景和美食好固然得偿所愿，真实的人像和人像下的故事也会给旅行增色不少。<br><img src="/uploads/travel_2/china4.jpg" alt="china4"><br>和好友聊天，得出的结论就是，对于芸芸大众来说，活到最后一定不是比谁赚的钱多，应该是比谁的故事多吧2333。<br><img src="/uploads/travel_2/west3.jpg" alt="west3"><br>在海滩边听着吉他弹唱夹杂着海浪海风的声音，吃着刚捕捞上来的海鲜做的烧烤，喝着当地的啤酒，和朋友聊天，听他们讲这么多年来的故事，从黄昏聊到夕阳，最后满眼繁星。想起之前的一句话，大概意思是说规规矩矩活到一百岁，还不如好酒好肉五十年。<br><img src="/uploads/travel_2/sea.jpg" alt="sea"><br>最近旅行还是会去著名景点打卡，但是会花更多的时间走近当地，和当地人聊天，看到和每天早高峰晚高峰中不一样的微笑和体验。我在高龙撒冷岛的时候，真不想回国过年啊，在那里躺尸一周也足够幸福。<br><img src="/uploads/travel_2/Thiland.jpg" alt="Thiland"><br>尽管吧，我们或许没有太多的共同点，但都有着同样的奇怪，同样对生活的热爱，对未来的迷茫，并且都对这种不确定性的迷茫安之若素。<br><img src="/uploads/travel_2/west1.jpg" alt="west1"><br>大概这样足够美好吧。<br>不知道未来怎么样，但恰是如此才满怀期待。<br><img src="/uploads/travel_2/west4.jpg" alt="west4"></p>
<h2 id="四、"><a href="#四、" class="headerlink" title="四、"></a>四、</h2><p>我在写这篇文章前，和很多朋友在聊对于生活的看法。<br>暂时找不到眼前苟且的意义，但是也算找到了出路。<br><img src="/uploads/travel_2/china1.jpg" alt="china1"><br>辛格有句话，大概的意思是，“看法总会过时，而故事永远常青。”<br><img src="/uploads/travel_2/china3.jpg" alt="china3"><br>最坏最坏的结果就是看法全部错了，<br>但至少能留下一个不错的故事就够了。<br><img src="/uploads/travel_2/china2.jpg" alt="china2"><br>我不入流，这不要紧。每天开心，才是最重要的。<br>“如果你不在乎某一个人对你的看法，一群人对你有什么意见又有什么关系？”<br><img src="/uploads/travel_2/west5.jpg" alt="west5"><br>以前大家聊天都是<br>“在干嘛呢”<br>“吃饭了吗”<br>“今天天气可真好啊”<br>现在都会以“接下去要去哪”作为开端或者结尾。<br>你这么瞎扯淡地游荡到底是想要干嘛呢？<br>这不是一个容易回答的问题。<br>但现在我想能不能换种方式来回答呢？<br>难道一定要知道想要干嘛才行吗。<br><img src="/uploads/travel_2/photo.jpg" alt="photo"></p>
<h2 id="五、"><a href="#五、" class="headerlink" title="五、"></a>五、</h2><p>刚看到朋友圈花花要暂时离开徒游，想着人生啊，总是会有相聚，也会有暂时的离别。只要一起经历的过程足够美好就好，就像骆驼走过的足迹，白牛耕过的地，诗人留下的热泪，时间长河里的一瞬。<br><img src="/uploads/travel_2/qd.jpg" alt="qd"><br>目前的情况下，我还远不足以像Jason和王阿牛那样说走就走踏上环游世界的征程。但是我想啊，weekday还是要好好工作，为之后的旅途积累资本，weekends我希望加入徒游，和我喜欢的领队一样，给这个城市一样有梦想的年轻人带去一个个难忘的周末；和我可爱的旅途中的朋友一块儿，继续在这条挚爱的路上一起行走。<br><img src="/uploads/travel_2/cambodia.jpg" alt="cambodia"><br>我不知道继续流浪到何方，和喜欢的人儿待在一起就很美好。和未知的可能性相逢、厮混、胡搅蛮缠、搏斗，或许落败，或许相爱。最后只留下几个，哪怕只是一个故事，我就没有白走过。<br><img src="/uploads/travel_2/west2.jpg" alt="west2"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2018/01/09/Flink四层执行图模型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/09/Flink四层执行图模型/" itemprop="url">Flink四层执行图模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-09T14:40:13+08:00">
                2018-01-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2018/01/07/Flink分布式运行时环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/Flink分布式运行时环境/" itemprop="url">Flink分布式运行时环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-07T10:00:13+08:00">
                2018-01-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flink/" itemprop="url" rel="index">
                    <span itemprop="name">Flink</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、Tasks-and-Operator-Chains（任务与运算链）"><a href="#一、Tasks-and-Operator-Chains（任务与运算链）" class="headerlink" title="一、Tasks and Operator Chains（任务与运算链）"></a>一、Tasks and Operator Chains（任务与运算链）</h2><p>在分布式执行时，Flink会将多个运算子任务链接到分布式计算任务中。每个任务都由一个线程执行。将运算符链接成任务是一个有用的优化：它减少了线程间切换和缓冲的开销，并增加了整体吞吐量，同时减少了延迟。链接行为可以在API中配置。</p>
<p>下图中的示例数据流由五个子任务执行，因此具有五个并行线程。<br><img src="/uploads/Flink分布式运行时环境/tasks_chains.svg" alt="tasks_chains"></p>
<h2 id="二、Job-Managers-Task-Managers-Clients（作业管理器，任务管理器与客户端）"><a href="#二、Job-Managers-Task-Managers-Clients（作业管理器，任务管理器与客户端）" class="headerlink" title="二、Job Managers, Task Managers, Clients（作业管理器，任务管理器与客户端）"></a>二、Job Managers, Task Managers, Clients（作业管理器，任务管理器与客户端）</h2><p>Flink运行时由如下两种进程构成:</p>
<ul>
<li><p><strong>JobManagers</strong>  (也被叫做masters)用来协调分布式系统的的执行。主要功能是调度任务, 调整检查点, 协调失败恢复过程等。<br>一个Flink环境中至少有一个Job Manager，一个高可用的系统在启动时会有多个JobManager，其中一个Job Manager一直是leader，其余的都随时待命，相当于主从机制。</p>
</li>
<li><p><strong>TaskManagers</strong> (也被叫做workers)用来在一条数据流图中执行任务(确切得说这些tasks其实就是subtasks，即计算子任务), 并用于数据流的缓冲和数据交换。<br>一个系统中至少要有一个TaskManager。</p>
</li>
</ul>
<p>JobManagers和TaskManagers可以在如下几种方式下启动:直接在单机上启动, 在容器上启动, 或者通过YARN、Mesos这样的资源框架管理。TaskManagers主动上连到JobManagers, 报告自身是否可用,以便JobManagers分配任务给它们。</p>
<p>client不属于运行时环境的一个组成部分, 但它用于准备并将数据流图发送给JobManager。发送完数据流图后，client可以断开连接，或者保持连接用来接收程序执行结果。client可以用Java或者Scala的形式执行，也可以用命令行(./bin/flink run…)来执行。</p>
<p><img src="/uploads/Flink分布式运行时环境/processes.svg" alt="processes"></p>
<h2 id="三、Task-Slots-and-Resources（任务槽和资源）"><a href="#三、Task-Slots-and-Resources（任务槽和资源）" class="headerlink" title="三、Task Slots and Resources（任务槽和资源）"></a>三、Task Slots and Resources（任务槽和资源）</h2><p>每个worker(TaskManager)都是一个JVM进程，每个子任务都是运行在独立的线程中。为了控制一个worker接收任务的数量，一个任务会分配至少一个任务槽。 </p>
<p>每一个任务槽都代表了一个TaskManager中特定的资源池子集。比如 TaskManager有三个任务槽，每个任务槽都有该TaskManager1/3的管理内存。将资源分槽意味着每一个计算子任务都有指定容量的内存资源，从而不会和其他子任务发生竞争。注意，这里没有对CPU隔离；任务槽只会隔离对应任务的内存。</p>
<p>用户通过调整任务槽的数量，可以自定义每个任务的计算子任务的数量。每个TaskManager只有一个任务槽的话，说明每个任务组都跑在一个独立的JVM上（如果Flink启动在一个独立的容器中）。有多个任务槽说明了有多个计算子任务在共享同一个JVM。在同一个JVM下的任务共享TCP连接(multiplexing：通过多路复用的方式)和心跳信息。任务之间也会共享数据集和数据结构，从而减少每个任务的开销。</p>
<p><img src="/uploads/Flink分布式运行时环境/tasks_slots.svg" alt="tasks_slots"></p>
<p>一般来说，即使计算子任务属于不同的任务，只要它们属于同一个job（作业），Flink都允许子任务共享任务槽。结果就是有可能每个槽都有完整的作业流水的场景。允许任务槽共享有以下两大好处：</p>
<ul>
<li><p>一个Flink集群需要在作业中确保任务槽数量和程序并发量完全一致，而并不需要计算程序中任务（每个任务的并发量也许都不相同）的具体数量。</p>
</li>
<li><p>我们非常容易就可以提高资源利用率。如果没有任务槽共享机制，非密集型的source/map()子任务就会和密集型的window子任务一样阻塞大量资源。如果有这个机制的话，如果在程序的并发量从2提高到6的情况下，就可以让密集型的子任务完全分散到任务管理器中，从而可以显著得提高槽的资源利用率。</p>
</li>
</ul>
<p><img src="/uploads/Flink分布式运行时环境/slot_sharing.svg" alt="slot_sharing"></p>
<p>Flink API中包含一个资源组机制，可以避免不合理的任务槽。</p>
<p><strong>按照以往的经验来看，默认的任务槽数量应设置成CPU核心的数量。如果使用超线程技术，每个槽中甚至可以调度两个硬件线程。</strong></p>
<h2 id="四、State-Backends（后端存储）"><a href="#四、State-Backends（后端存储）" class="headerlink" title="四、State Backends（后端存储）"></a>四、State Backends（后端存储）</h2><p>通过键值对索引的数据结构保存在选定的后端存储中。有的后端存储使用内存中的哈希表来存储数据，另外的后端存储会使用RocksDB来存储键值对。除了定义保存状态的数据结构外，后端存储还实现了获取键值对的特定时间点快照的功能，该功能可以将快照保存为检查点的一部分。</p>
<p><img src="/uploads/Flink分布式运行时环境/checkpoints.svg" alt="checkpoints"></p>
<h2 id="五、Savepoints（保存点）"><a href="#五、Savepoints（保存点）" class="headerlink" title="五、Savepoints（保存点）"></a>五、Savepoints（保存点）</h2><p>使用Data Stream API的程序可以从保存点恢复过来。保存点可以在不丢失状态的情况下更新程序和Flink集群。</p>
<p>保存点是一种手动触发的检查点，获取程序快照并将其写入后端存储中。因此保存点依赖于常规检查点的机制。在程序执行期间，会定期得在worker节点生成快照和检查点。只有最新一个有效的检查点是对Flink修复机制有效的，一旦有新的检查点生成了，那些旧的检查点就可以被安全移除了。</p>
<p>保存点和定期检查点在大部分情况下很像，除了保存点是用户手动触发的，当新的检查点生成时，老的检查点不会自动到期失效。保存点可以通过命令行生成，也可以在调用 REST API 取消作业时产生。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2017/10/11/把魂丢在了腾格里/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/11/把魂丢在了腾格里/" itemprop="url">把魂丢在了腾格里</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-11T21:05:10+08:00">
                2017-10-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/uploads/tgl1.jpg" alt="tgl1"></p>
<p><img src="/uploads/tgl2.jpg" alt="tgl2"></p>
<p><img src="/uploads/tgl3.jpg" alt="tgl3"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2017/02/24/网格问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/24/网格问题/" itemprop="url">网格问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-24T20:36:22+08:00">
                2017-02-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天看到一个算法题，题目如下：</p>
<p>猪场有一个x*y的网格盒子，网格的行编号为0~x-1，列编号为0~y-1。每个格子至多可以放一块蛋糕，任意两块蛋糕之间的欧几里得距离不能等于2。对于两个格子坐标（x1,y1),(x2,y2)的欧几里得距离为((x1-x2)^2+(y1-y2)^2)的算术平方根，猪场老板想知道最多可以放多少块蛋糕在网络格子里。</p>
<h3 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h3><p>x&gt;=1,y&lt;=1000</p>
<h3 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h3><p>输出一个最多可以放的蛋糕数和网格的情况。</p>
<h3 id="输入例子："><a href="#输入例子：" class="headerlink" title="输入例子："></a>输入例子：</h3><p>x=3，y=2</p>
<h3 id="输出例子："><a href="#输出例子：" class="headerlink" title="输出例子："></a>输出例子：</h3><p>4</p>
<h3 id="我的思考："><a href="#我的思考：" class="headerlink" title="我的思考："></a>我的思考：</h3><p>若要满足题目条件，同一行的两个蛋糕要隔两行以上，且同一列的蛋糕要隔两列以上。</p>
<p>要满足最大化的条件，则同一行的两个蛋糕隔两行，同一列的蛋糕隔两列。</p>
<p>经过演算，一种是2<em>2方块组每隔两行或者两列铺列开来，另一种是对角线</em>2每隔两个对角线铺列开来。本质其实是一样的，都是满足上述最大化的条件。</p>
<h3 id="我实现了第一种方案："><a href="#我实现了第一种方案：" class="headerlink" title="我实现了第一种方案："></a>我实现了第一种方案：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> new2017;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wangge</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x = <span class="number">10</span>, y = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">int</span>[][] a = <span class="keyword">new</span> <span class="keyword">int</span>[x][y];</span><br><span class="line">  maxWangge(a);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">maxWangge</span><span class="params">(<span class="keyword">int</span>[][] a)</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x=a.length,y=a[<span class="number">0</span>].length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; x; i++) &#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; y; j++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">2</span> &amp;&amp; j &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (a[i - <span class="number">2</span>][j] == <span class="number">0</span> &amp;&amp; a[i][j - <span class="number">2</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">      addCount(a,i,j);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &gt;= <span class="number">2</span> &amp;&amp; j &lt; <span class="number">2</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (a[i - <span class="number">2</span>][j] == <span class="number">0</span>) &#123;</span><br><span class="line">      addCount(a,i,j);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; <span class="number">2</span> &amp;&amp; j &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (a[i][j - <span class="number">2</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">      addCount(a,i,j);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     addCount(a,i,j);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  System.out.println(<span class="string">"最大的蛋糕数为:"</span>+count);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span>[] b : a)&#123;</span><br><span class="line">   System.out.println(Arrays.toString(b));</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addCount</span><span class="params">(<span class="keyword">int</span>[][] a,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">  a[i][j] = <span class="number">1</span>;</span><br><span class="line">  count++;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">最大的蛋糕数为:<span class="number">52</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><br>总结：像今天的网格问题和我之前分享的Wikioi问题，都可以通过二维数组的简单比较实现，记得注意边界值的判断哦。</p>
<p>我是Wikioi推送门：Wikioi的简单实现</p>
<p>作者：有奶喝先森<br>链接：<a href="http://www.jianshu.com/p/ca6c5f3c3950" target="_blank" rel="noopener">http://www.jianshu.com/p/ca6c5f3c3950</a><br>來源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2017/02/17/Java多线程编程核心技术1——Thread类核心API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/17/Java多线程编程核心技术1——Thread类核心API/" itemprop="url">Java多线程编程核心技术1——Thread类核心API</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T21:50:37+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java多线程/" itemprop="url" rel="index">
                    <span itemprop="name">Java多线程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="Thread类相关状态和方法示意图："><a href="#Thread类相关状态和方法示意图：" class="headerlink" title="Thread类相关状态和方法示意图：﻿"></a>Thread类相关状态和方法示意图：﻿</h3><p><img src="/uploads/Thread类相关状态和方法示意图.jpg" alt="Thread类相关状态和方法示意图"></p>
<h1 id="一-Thread类核心API使用"><a href="#一-Thread类核心API使用" class="headerlink" title="﻿一. Thread类核心API使用"></a>﻿一. Thread类核心API使用</h1>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/17/Java多线程编程核心技术1——Thread类核心API/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2017/02/17/Wikioi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/17/Wikioi/" itemprop="url">Wikioi</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T20:36:06+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> new2017;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wikioi</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组构建</span></span><br><span class="line"></span><br><span class="line">Scanner scan = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"please input the height:"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n = scan.nextInt();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>[][] a = <span class="keyword">new</span> <span class="keyword">int</span>[n][];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"></span><br><span class="line">a[i] = <span class="keyword">new</span> <span class="keyword">int</span>[i + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"please input datas:"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; j++) &#123;</span><br><span class="line"></span><br><span class="line">a[i][j] = scan.nextInt();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// int[][] a = &#123; &#123; 7 &#125;, &#123; 3, 8 &#125;, &#123; 8, 1, 0 &#125;, &#123; 2, 7, 4, 4 &#125;, &#123; 4, 5, 2, 6, 5 &#125; &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int n = a.length;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0x80000000</span>;<span class="comment">// -2147483648</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; j++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">0</span>) &#123;<span class="comment">// 第一层</span></span><br><span class="line"></span><br><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>] = a[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (j == <span class="number">0</span>) &#123;<span class="comment">// 每一层的最左边单独处理</span></span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i - <span class="number">1</span>][<span class="number">0</span>] + a[i][j];</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == i) &#123;<span class="comment">// 每一层的最右边单独处理</span></span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i - <span class="number">1</span>][i - <span class="number">1</span>] + a[i][j];</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// 中间的比较对应的上面两个哪个大</span></span><br><span class="line"></span><br><span class="line">dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] &gt; dp[i - <span class="number">1</span>][j] ? dp[i - <span class="number">1</span>][j - <span class="number">1</span>] : dp[i - <span class="number">1</span>][j] + a[i][j];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;<span class="comment">// 遍历最后一层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (dp[n - <span class="number">1</span>][j] &gt; ans) &#123;</span><br><span class="line"></span><br><span class="line">ans = dp[n - <span class="number">1</span>][j];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(ans);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">please input the height:</span><br><span class="line"><span class="number">5</span></span><br><span class="line">please input datas:</span><br><span class="line"></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure><br>作者：有奶喝先森<br>链接：<a href="http://www.jianshu.com/p/29707d65f420" target="_blank" rel="noopener">http://www.jianshu.com/p/29707d65f420</a><br>來源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2017/02/17/TireTree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/17/TireTree/" itemprop="url">TireTree</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T20:35:49+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tiretree;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TireTree</span> </span>&#123;<span class="comment">// Baidu搜索用到的数据结构</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Node	root;<span class="comment">//根节点</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TireTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">root = <span class="keyword">new</span> Node(); <span class="comment">// 构造：Tree下面的Node</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">Node t = root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;<span class="comment">// i change , and t change</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自己定义了一套规则，每一次都是26个位置对应到26个字母</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (t.nodes[str.charAt(i) - <span class="string">'a'</span>] == <span class="keyword">null</span>) &#123;<span class="comment">// 如果不存在该位置</span></span><br><span class="line"></span><br><span class="line">Node node = <span class="keyword">new</span> Node();</span><br><span class="line"></span><br><span class="line">t.nodes[str.charAt(i) - <span class="string">'a'</span>] = node;<span class="comment">// 把新建的node位置赋给这个值-&gt;t.nodes[str.charAt(i) - 'a']</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">t = t.nodes[str.charAt(i) - <span class="string">'a'</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">t.isStr = <span class="keyword">true</span>;<span class="comment">// 令插入的最后一个字符为true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node t = new Node();//root是TireTree构造出来的，这个root可以应用在find中去判断</span></span><br><span class="line"></span><br><span class="line">Node t = root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length() &amp;&amp; t != <span class="keyword">null</span>; i++) &#123;<span class="comment">// t != null ----&gt;&gt;对应的这个节点不为空</span></span><br><span class="line"></span><br><span class="line">t = t.nodes[str.charAt(i) - <span class="string">'a'</span>];<span class="comment">// 循环遍历</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (t != <span class="keyword">null</span> &amp;&amp; t.isStr);<span class="comment">// 最后一位不为空且标志位为true，isStr：避免树中有abcde，abc也蒙混过关了</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;<span class="comment">// 代表每一个节点（一个字符）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span>	isStr;	<span class="comment">// 字符串末尾的标志</span></span><br><span class="line"></span><br><span class="line">Node[]	nodes;	<span class="comment">// Node[26]数组</span></span><br><span class="line"></span><br><span class="line">Node() &#123;</span><br><span class="line"></span><br><span class="line">isStr = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">nodes = <span class="keyword">new</span> Node[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">TireTree tireTree = <span class="keyword">new</span> TireTree();</span><br><span class="line"></span><br><span class="line">tireTree.insert(<span class="string">"abc"</span>);</span><br><span class="line"></span><br><span class="line">tireTree.insert(<span class="string">"abc"</span>);</span><br><span class="line"></span><br><span class="line">tireTree.insert(<span class="string">"bcd"</span>);</span><br><span class="line"></span><br><span class="line">tireTree.insert(<span class="string">"cdefg"</span>);</span><br><span class="line"></span><br><span class="line">tireTree.insert(<span class="string">"aaaaa"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"abc:"</span> + tireTree.find(<span class="string">"abc"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"abd:"</span> + tireTree.find(<span class="string">"abd"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"abcd:"</span> + tireTree.find(<span class="string">"abcd"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"abcd:"</span> + tireTree.find(<span class="string">"ab"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"bc:"</span> + tireTree.find(<span class="string">"bc"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"bcd:"</span> + tireTree.find(<span class="string">"bcd"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"cdefg:"</span> + tireTree.find(<span class="string">"cdefg"</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"aaaaa:"</span> + tireTree.find(<span class="string">"aaaaa"</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">abc:<span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">abd:<span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">abcd:<span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">abcd:<span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">bc:<span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">bcd:<span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">cdefg:<span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">aaaaa:<span class="keyword">true</span></span><br></pre></td></tr></table></figure><br>作者：有奶喝先森<br>链接：<a href="http://www.jianshu.com/p/88bb88051730" target="_blank" rel="noopener">http://www.jianshu.com/p/88bb88051730</a><br>來源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://pangongsen.github.io/2017/02/17/Java多线程编程核心技术4-单例程式与多线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PanGongsen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PanGongsen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/17/Java多线程编程核心技术4-单例程式与多线程/" itemprop="url">Java多线程编程核心技术4--单例程式与多线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T20:35:21+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java多线程/" itemprop="url" rel="index">
                    <span itemprop="name">Java多线程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>1.立即加载/饿汉模式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  System.out.println(MyObject.getInstance().hashCode());</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> MyObject myObject = <span class="keyword">new</span> MyObject();</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyObject <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> myObject;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Run</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  MyThread t1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">  MyThread t2 = <span class="keyword">new</span> MyThread();</span><br><span class="line">  MyThread t3 = <span class="keyword">new</span> MyThread();</span><br><span class="line">  t1.start();</span><br><span class="line">  t2.start();</span><br><span class="line">  t3.start();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>运行结果皆为：<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/02/17/Java多线程编程核心技术4-单例程式与多线程/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/uploads/avatar.jpg"
              alt="PanGongsen" />
          
            <p class="site-author-name" itemprop="name">PanGongsen</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PanGongsen</span>

  
</div>


  <div class="powered-by">骄傲得使用 <a class="theme-link" href="https://hexo.io">Hexo</a> </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.2</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

  
</body>
</html>
